using System.Collections;
using UnityEngine;
using TMPro;
using UnityEngine.SceneManagement;

public class ScoreManager : MonoBehaviour
{
    public static int score = 0;
    private float remainingTime;
    public GameObject gameOverPanel;
    public TextMeshProUGUI gameOverText;
    public TextMeshProUGUI scoreText;
    public CharacterMovement player;

    private bool isGameOver = false; // üëà tr√°nh g·ªçi GameOver nhi·ªÅu l·∫ßn

    public static void AddScore(int amount)
    {
        score += amount;
    }

    void Start()
    {
        remainingTime = 30f; // ƒë·ªÉ 3f khi test, c√≤n 30f l√† th·ªùi gian th·∫≠t
        StartCoroutine(CountdownTimer());
    }

    void Update()
    {
        // Hi·ªÉn th·ªã th·ªùi gian & ƒëi·ªÉm
        scoreText.text = $"Score: {score} | Time: {Mathf.CeilToInt(remainingTime)}";

        // Cho ph√©p restart khi Game Over
        if (isGameOver && Input.GetKeyDown(KeyCode.R))
        {
            SceneManager.LoadScene(SceneManager.GetActiveScene().name);
        }
    }

    private IEnumerator CountdownTimer()
    {
        while (remainingTime > 0)
        {
            yield return new WaitForSeconds(1f);
            remainingTime--;
        }

        GameOver();
    }

    private void GameOver()
    {
        if (isGameOver) return; // üëà tr√°nh b·ªã g·ªçi l·∫°i n·∫øu coroutine ch·∫°y tr·ªÖ

        isGameOver = true;
        gameOverPanel.SetActive(true);
        gameOverText.text = $"Game Over!\nScore: {score}";

        if (player != null)
        {
            player.GameOver();
        }

        Time.timeScale = 0f;

    }
}
